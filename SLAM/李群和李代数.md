# 李群和李代数

前面我们介绍了若干种描述三维世界刚体运动的方式。除了用它们来描述相机的位姿之外，还要对它们进行**估计**和**优化**。这个问题可以描述为**什么样的相机位姿最符合当前观测数据**。而典型的做法就是将其构建成一个优化问题来求解。

前面我们介绍了旋转矩阵、旋转向量和四元数等等。而李群和李代数又是什么，我们为什么需要它们？这个问题我们过一会解答，先来看看李群和李代数。

## 李群

上一讲在介绍旋转矩阵和变换矩阵时，我们说三维旋转矩阵构成了*特殊正交群* SO(3)，变换矩阵构成了*特殊欧式群* SE(3)。我们知道，矩阵**对于乘法是封闭**的，即假设相机进行了两次连续的旋转，旋转矩阵分别为$\mathbf{R}_1$ 和$\mathbf{R}_2$, 这两个矩阵相乘后得到的也是个旋转矩阵，表示了总的旋转。也即：
$$
\forall \mathbf{R}_1,\mathbf{R}_2 \in SO(3),\  \mathbf{R}_1\mathbf{R}_2 \in SO(3)
$$
对变换矩阵也是如此。但这二者**对于加法是不封闭的**。两个变换矩阵相加后得到的矩阵并不是一个变换矩阵。

### 群

如此，我们就可以引出群的**定义**：群（group）是**一种集合加上一种运算**的**代数结构**。把集合记为$\mathbf{A}$，运算记为$\cdot$, **群就可以记为**$\mathbf{G}=(\mathbf{A},\ \cdot)$。而这个运算必须满足以下条件：

1. 封闭性：$\forall a_1,a_2 \in \mathbf{A},\  a_1 \cdot a_2 \in \mathbf{A}$
2. 结合律：$\forall a_1,a_2,a_3 \in \mathbf{A},\  (a_1 \cdot a_2) \cdot a_3 = a_1\cdot (a_2 \cdot a_3)$
3. 幺元：$\exists a_0 in \mathbf{A},\  s.t. \  \forall a \in \mathbf{A}, a_0 \cdot a = a \cdot a_0$
4. 逆：$\forall a \in \mathbf{A},\exists a^{-1} \in A, \  s.t.\  a \cdot a^{-1}=a_0$

可以验证，旋转矩阵集合和变换矩阵集合分别和矩阵乘法构成群。还有其他很多群，如整数的加法等。**群结构保证了在群上的运算具有良好的性质**。

### 李群

**定义**：*李群*就是具有**连续（光滑）**性质的群。

前面举的整数的加法的例子显然不是连续的，因而它不是李群。但SO(3) 和SE(3) 在实数空间上是**连续**的（机器人在三维空间中显然是连续地运动，而不会进行“瞬移”）。

介绍完李群，在引入李代数之前，我们来回顾下开头我们提到的问题：为什么要用到李群和李代数？避免一直是数学上的推到。我们用一个比较实际的例子。假设某个时刻我们预测机器人的位姿为$\mathbf{T}$（待定值）, 它观测到了一个惯性坐标系下的点$\mathbf{p}$ 而产生了一个观测数据$\mathbf{z}$，它是该点在相机坐标系下的坐标，则可得
$$
\mathbf{z}=\mathbf{T}\mathbf{p}+\mathbf{\omega}
$$
其中，$\mathbf{\omega}$ 是观测噪声。由于观测噪声的存在，$\mathbf{z}$ 无法严格满足式$\mathbf{z}=\mathbf{T}\mathbf{p}$。因此而产生的误差$\mathbf{e}$ 为
$$
\mathbf{e}=\mathbf{z}-\mathbf{Tp}
$$
若共有N 个观测值，那么就有N 个这样的式子。机器人的位姿估计就转变成寻找一个最优的$\mathbf{T}$ 使得整体的误差最小化：
$$
\mathop{\min}_{T} J(\mathbf{T})=\sum\limits^N_{i=1}||\mathbf{z}_i-\mathbf{T}\mathbf{p}_i||^2_2
$$
通常，直接求解上式得出最优的$\mathbf{T}$是很困难的（或计算量很大）。我们常常先给定一个猜测值（初始值）$\mathbf{T}_0$，然后不断地对它进行迭代更新。而这个过程需要用到导数（可以想想梯度下降法）。回顾导数的定义，$\dot{f(x)}=\lim_{\Delta x \to 0} \frac{f(x+\Delta x)}{\Delta x}$。显然计算导数和进行更新时都要用到加法。但SO(3) 和SE(3) 上对矩阵加法的运算并不封闭。如果要继续采取这个迭代更新的策略势必要再想想办法，使得导数“可行”。而这就可以通过李群及其对应的李代数来实现。

## 李代数

### 引出

现在我们考虑任意的旋转矩阵$\mathbf{R}$，根据上一讲的知识，有
$$
\mathbf{R}\mathbf{R}^T=\mathbf{I}
$$
因为机器人在不断运动，所以$\mathbf{R}$ 也在随时间不断变换，引入时间$t$ 就得到$\mathbf{R}(t)$，上式也变成
$$
\mathbf{R}(t)\mathbf{R}(t)^T=\mathbf{I}
$$
等式两边一起对时间求导可得：
$$
\dot{\mathbf{R}}(t)\mathbf{R}(t)^T+\mathbf{R}(t)\dot{\mathbf{R}}(t)^T=0
$$
亦即
$$
\dot{\mathbf{R}}(t)\mathbf{R}(t)^T=-\mathbf{R}(t)\dot{\mathbf{R}}(t)^T=-(\dot{\mathbf{R}}(t)\mathbf{R}(t)^T)^T
$$
一个矩阵等于其自身转置后取负号，可知$\dot{\mathbf{R}}(t)\mathbf{R}(t)^T$ 是一个**反对称矩阵**。我们之前就介绍过反对称矩阵和^ 符号，可知对应地，对于任意的反对称矩阵，可以找到一个与之对应的向量，这个关系可以用$^\vee$ 来表示：
$$
\mathbf{a}^\wedge=\mathbf{A}=
\begin{bmatrix}
0 & -a_3 & a_2 \\
a_3 & 0 & -a_1 \\
-a_2 & a_1 & 0 \\
\end{bmatrix}
, \ \ \mathbf{A}^\vee=\mathbf{a}
$$
设这个对应的向量为$\phi(t)\in R^3$，就有
$$
\dot{\mathbf{R}}(t)\mathbf{R}(t)^T=\phi(t)^\wedge
$$
等式两边同时右乘$\mathbf{R}(t)$ 则有
$$
\dot{\mathbf{R}}(t)=\phi(t)^\wedge\mathbf{R}(t)
$$
从式(11) 可以看到，每对旋转矩阵求一次导数，只需要左乘一个$\phi(t)^\wedge$ 就可以了。假设t~0~ = 0 并设此时$\mathbf{R}(0)=\mathbf{I}$，对式(10) 进行一阶泰勒展开就有：
$$
\mathbf{R}(t) \approx \mathbf{R}(t_0)+\dot{\mathbf{R}}(t_0)(t-t_0)=\mathbf{I}+\phi(t_0)^\wedge \cdot (t)
$$
**NOTE**：$\phi$ 反应了$\mathbf{R}$ 的导数的性质，故称它在SO(3) 原点附近的正切空间（Tangent Space）上。

同时，在t~0~ 附近，设$\phi$ 也是一个常数，即$\phi(t_0)=\phi_0$，根据式(11) 就有
$$
\dot{\mathbf{R}}(t)=\phi(t_0)^\wedge\mathbf{R}(t)=\phi_0^\wedge\mathbf{R}(t)
$$
显然，上式是一个关于$\mathbf{R}$ 的微分方程，而且知道初始值$\mathbf{R}(0)=\mathbf{I}$，他的解为
$$
\mathbf{R}(t)=\exp (\phi_0^\wedge t)
$$
由于我们之前做了一些假设，所以这个式子只在t **附近有效**。

但通过式(14) 我们知道，**当某个时刻的$\mathbf{R}$ 已知时，存在一个向量$\phi$，二者满足这个矩阵指数关系** 。而这个$\phi$，就是对应到SO(3) 上的李代数so(3)。下面我们就介绍一下李代数的定义和如何计算矩阵指数$\exp(\phi^{\wedge})$.

### 李代数的定义

每个李群都有与之对应的李代数。**李代数描述了李群的局部性质**。其**定义**为：李代数由一个集合$V$, 一个数域$F$ 和一个二元运算$[,]$, 组成。如果它们满足以下几条性质，则称$(V, F, [,])$, 记作g。

- 封闭性：$\forall \mathbf{X}, \mathbf{Y} \in V,\ [\mathbf{X}, \mathbf{Y}] \in V$.
- 双线性：$\forall \mathbf{X}, \mathbf{Y}, \mathbf{Z} \in V,\ a, b \in F$, 有$[a\mathbf{X}+b\mathbf{Y},\ \mathbf{Z}]=a[\mathbf{X}, \mathbf{Z}]+[\mathbf{Y}, \mathbf{Z}],\ [\mathbf{Z},a\mathbf{X}+b\mathbf{Y}]=a[\mathbf{Z},\mathbf{X}]+b[\mathbf{Z},\mathbf{Y}]$
- 自反性：$\forall \mathbf{X} \in V,\ [\mathbf{X}, \mathbf{X}]=\mathbf{0}$.
- 雅可比等价：$\forall \mathbf{X},\mathbf{Y},\mathbf{Z} \in V,\ [\mathbf{X},[\mathbf{Y},\mathbf{Z}]]+[\mathbf{Z},[\mathbf{X},\mathbf{Y}]]+[\mathbf{Y},[\mathbf{Z},\mathbf{X}]]=\mathbf{0}$.

其中的二元运算$[,]$ 称为**李括号**，它**表达了两个元素的差异**。三维向量R^3^ 上定义的叉积就是一种李括号，$g=(R^3,R,\times)$ 就构成了李代数。

### 李代数so(3)

之前我们提到的SO(3) 对应的向量$\phi$ 就是一种李代数，是定义在R^3^ 上的向量。它的反对称矩阵记为$\mathbf{\Phi}=\phi^\wedge$. 在定义下面，两个向量$\phi_1, \phi_2$ 的李括号为：
$$
[\phi_1, \phi_2]=(\mathbf{\Phi_1}\mathbf{\Phi_2}-\mathbf{\Phi_2}\mathbf{\Phi_1})^\vee
$$
高翔在书中没有明说，但经过计算可以得到结果为$\phi_1, \phi_2$ 的叉积（又叫外积）。所以这里我猜测so(3) 对应的李括号为三维向量R^3^ 上的叉积。
$$
so(3)=\{\phi \in R^3,\ \mathbf{\Phi}=\phi^\wedge \in R^{3\times 3}\}
$$
至此，我们已经清楚了so(3) 的内容：它们是一个由三维向量组成的集合；每个向量对应到一个反对称矩阵；（李括号为三维向量的外积运算）；可以用来表达旋转矩阵的导数，和SO(3) 的关系由指数映射给定：$\mathbf{R}=\exp (\phi^\wedge)$.

下面我们先看李代数se(3) 再来解释指数映射。

### 李代数se(3)

对于SE(3)，它也有对应的李代数se(3)。和so(3) 类似，se(3) 在R^6^ 空间中：
$$
se(3)=\begin{Bmatrix}
\mathbf{\xi}=\begin{bmatrix} \mathbf{\rho} \\ \mathbf{\phi} \end{bmatrix} \in R^6,\mathbf{\rho} \in R^3, \mathbf{\phi} \in so(3), \mathbf{\xi}^\wedge=\begin{bmatrix}\phi^\wedge & \mathbf{\rho} \\ \mathbf{0}^T & 0 \end{bmatrix} \in R^{4 \times 4}
\end{Bmatrix} 
$$
把每个se(3) 元素记做$\xi$，它是一个六维向量：前三维为平移，记作$\rho$；后三维是旋转，记作$\phi$，实质上是s0(3) 元素。此外，在se(3) 中，$^\wedge$ 符号的含义被拓展了：这里它将一个六维向量转换为四维矩阵，但这里不再表示反对称矩阵。

同样，李代数se(3) 也有类似的李括号：
$$
[\xi_1,\ \xi_2]=(\xi_1^\wedge \xi_2^\wedge - \xi_2^\wedge\xi_1^\wedge)^\vee
$$
##指数和对数映射